#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Stash any unstaged changes
UNSTAGED=$(git diff --name-only)
if [ -n "$UNSTAGED" ]; then
  git stash --keep-index --quiet
  STASHED=1
fi

# Run lint-staged
npx lint-staged

# Check if lint-staged succeeded
if [ $? -ne 0 ]; then
  echo "❌ lint-staged failed. Fix the issues and try committing again."
  # Restore unstaged changes if we stashed them
  if [ -n "$STASHED" ]; then
    git stash pop --quiet
  fi
  exit 1
fi

# Restore unstaged changes if we stashed them
if [ -n "$STASHED" ]; then
  git stash pop --quiet
fi

echo "✅ Pre-commit checks passed!"
